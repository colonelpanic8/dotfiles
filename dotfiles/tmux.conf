# Automatically rename new sessions to the basename of the current directory
# Handles duplicates by appending -2, -3, etc.
set-hook -g session-created 'run-shell "
  base=$(basename \"#{pane_current_path}\")
  if tmux has-session -t \"$base\" 2>/dev/null; then
    i=2
    while tmux has-session -t \"${base}-${i}\" 2>/dev/null; do
      i=$((i+1))
    done
    tmux rename-session -t \"#{session_name}\" \"${base}-${i}\"
  else
    tmux rename-session -t \"#{session_name}\" \"$base\"
  fi
"'

# Also rename when attaching to a session (optional)
set-hook -g client-session-changed 'run-shell "
  base=$(basename \"#{pane_current_path}\")
  if tmux has-session -t \"$base\" 2>/dev/null; then
    i=2
    while tmux has-session -t \"${base}-${i}\" 2>/dev/null; do
      i=$((i+1))
    done
    tmux rename-session -t \"#{session_name}\" \"${base}-${i}\"
  else
    tmux rename-session -t \"#{session_name}\" \"$base\"
  fi
"'
